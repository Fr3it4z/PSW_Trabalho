<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <title>Estatísticas</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav>
      <div>
        <a href="/dashboard.html">Meus Filmes</a>
        <a href="/manage.html">Gestão de Filmes</a>
        <a href="/stats.html"><b>Estatísticas</b></a>
      </div>
      <button onclick="logout()">Sair</button>
    </nav>
    <hr />
    <h2>Ranking de Utilizadores (Por Acessos)</h2>
    <table id="stats-table">
      <thead>
        <tr>
          <th>Utilizador</th>
          <th>Nº Acessos à API</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      function logout() {
        fetch("/auth/logout", { method: "POST" }).then(
          () => (window.location.href = "/")
        );
      }

      function loadStats() {
        fetch("/api/stats")
          .then((res) => res.json())
          .then((data) => {
            const tbody = document.querySelector("#stats-table tbody");
            // Limpa tabela antes de preencher
            tbody.innerHTML = "";

            data.forEach(function (user) {
              const row = tbody.insertRow();
              const cell1 = row.insertCell(0);
              const cell2 = row.insertCell(1);
              cell1.innerText = user.username;
              cell2.innerText = user.acessos;
            });
          })
          .catch((err) => console.error(err));
      }
      loadStats();
    </script>
  </body>
</html>
